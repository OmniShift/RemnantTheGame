<!DOCTYPE html>

<html lang='en'>
	<head>
		<meta charset='utf-8' />
		<link type='text/css' rel='stylesheet' href='style.css'/>
		<title>Remnant - The Game</title>
	</head>
	<script src='/socket.io/socket.io.js'></script>
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js'></script>
	<script>
		$(document).ready(function(){
			var socket = io();
			var el = document.getElementById('serverTime');

			socket.on('time', function(timeString) {
				el.innerHTML = 'Server time: ' + timeString;
			});

			//document.cookie = "rtgUID=AdmUsr; expires=Thu, 31 Dec 2026 12:00:00 GMT";

			socket.on('return generated UID', function(userID){
				document.cookie = 'rtgUID=' + userID + '; expires=Thu, 31 Dec 2026 12:00:00 GMT';
				console.log('Your new ID is ' + userID);
				console.log('Your new ID is ' + getCookie('rtgUID'));
			});

			function checkCookie(){
				var localUserID = getCookie('rtgUID', 6);
				console.log('Your userID is ' + localUserID);
				if (localUserID != ''){
					console.log('User ' + localUserID + ' is connected.');
				} else {
					console.log('New user connected. ID will be generated.');
					generateUID();
				};
			};

			function getCookie(cname, cvallength){
				console.log(document.cookie.substring(document.cookie.search(cname) + cname.length + 1, (document.cookie.search(cname) + cname.length + 1 + cvallength)));
				return document.cookie.substring(document.cookie.search(cname) + cname.length + 1, (document.cookie.search(cname) + cname.length + 1 + cvallength));
				/*console.log(document.cookie);
				var name = cname = '=';
				var ca = document.cookie.split(';');
				for (var i = 0; i < ca.length; i++){
					var c = ca[i];
					while (c.charAt(0) == ' '){
						c = c.substring(1);
					};
					if (c.indexOf(name) == 0 ){
						console.log(c.substring(name.length,c.length));
						return c.substring(name.length,c.length);
					};
				};
				console.log('no UID found');
				return '';*/
			};

			function generateUID(){
				socket.emit('generate UID');
				console.log('generate UID request sent');
			};

			checkCookie();
		});
	</script>
	<body>
		<div id='backgroundMain'>
		<div id='overlay'>
			<div id='serverTime' style='text-align:center'></div><BR>
			<div id='newsBoard'><b>News</b><BR>
				<div style='width:600px; height:2px; display:inline-block; background-color:black'></div><BR>
				<table id='newsTable' style='padding:5px'>
					<tr>
						<td class='newsTime'>11-7-2016</td>
						<td class='newsContent'>After a long time of silence, the home page is finally mostly functional up until the creation of lobbies. Let the socket work begin! ...tomorrow.</td>
					</tr>
					<tr>
						<td class='newsTime'>19-6-2016</td>
						<td class='newsContent'>The news feed's basic code has been set up, with exception of the connection to the database to update it without having to take down the whole website.</td>
					</tr>
					<tr>
						<td class='newsTime'>18-6-2016</td>
						<td class='newsContent'>I know I didn't have a news feed at this date, but that's none of your business. I just need some extra code to help me remind how to add more news in the future!</td>
					</tr>
				</table>
			</div>

			<div style='text-align:center'><h1>Remnant - The Game</h1>
			<h2>Show those pesky Remnantians who was meant to rule them</h2>
			<button id='createJoinButton' onclick='newGameWarning()'>Create/Join New Game</button><BR>
			<button id='continueGameButton' onclick='continueGame()' disabled=''>Continue Game</button><BR>
			<button id='testerIDButton' onclick='toTestersPage()'>To Testers Page</button><BR>
			<button onclick='testFunc()'>php test</button><BR>
			<!--<button onclick="showNewGameSettings()">test button 2</button></div>-->

			<div class='popUp' id='newGameSettings'>
				<div class='popUpTop' style='text-align:center'><div style='font-weight:bold; font-size:1.7em; padding:7px'>New game</div>
					<!--<b><u>Commander name:</u></b><BR>
					<input id="comName" type="text" name="commander"><BR>-->
					<p style='text-align:center; font-size:1.5em'>There are no settings yet this early on in the game's development, so you have no options to choose from.</p>
					<p style='text-align:center; font-size:1.5em'>...you lucky devil!</p>
				</div>
				<!--<BR>
				<div class="popUpList">
					<b><u>Base game:</u></b><BR>
					<select>
						<option id="baseGamePack" value="original">Original</option>
					</select><BR>
					<BR>
					<b><u>Expansions:</u></b><BR>
					<input id="semblanceExp" type="checkbox" name="semblance" disabled="">test1 (N/A)<BR>
					<input id="modernDayHeroesExp" type="checkbox" name="modernDayHeroes" disabled="">test2 (N/A)<BR>
				</div>
				<div class="popUpList">
					<b><u>'Features':</u></b><BR>
					<input type="checkbox" name="tuck" disabled="">test (N/A)<BR>
				</div>
				<BR>-->
				<div class='popUpBottom'>
					<button onclick='goToLobby()'>Create</button>
					<button onclick='hideNewGameSettings()'>Cancel</button>
				</div>
			</div>

			<div class='popUp' id='AYSprompt'>
				<div class='popUpTop' style='text-align:center'>
					<div style='font-weight:bold; font-size:1.7em; padding:7px'>Create/join new game</div>
					<p id='AYStextField' style='font-size:1.2em'></p>
				</div>
				<div class='popUpBottom'>
					<button onclick='newGameSettings()'>Create game</button>
					<button onclick='joinNewGame()'>Join game</button>
					<button onclick='hideAYSPrompt()'>Cancel</button>
				</div>
			</div>

			<div class='popUp' id='joinNewGame'>
				<div class='popUpTop' style='text-align:center'>
					<div style='font-weight:bold; font-size:1.7em; padding:7px'>Join new game</div>
				</div>
				<div class='popUpBottom'>
					<p style='font-size:1.2em'>Please insert your room code:<BR>
					<input id='roomCode' type='text' name='roomCode' autocomplete='off'></p>
					<button onclick='roomCodeCheck()'>Join game</button>
					<button onclick='hideJoinNewGame()'>Cancel</button>
				</div>
			</div>
		</div><!--end of overlay-->
		</div><!--end of backgroundMain-->

		<script type='text/javascript'>
			function testFunc() {
				window.location.href = '/test.php';
			};
			function toTestersPage(){
				window.location.href = '/setTesters.html';
			};

			function hideAYSPrompt() {
				document.getElementById('AYSprompt').style.visibility = 'hidden';
				document.getElementById('overlay').style.backgroundColor = 'rgba(0,0,0,0)';
				document.getElementById('createJoinButton').disabled = false;
			};
			function hideNewGameSettings() {
				document.getElementById('newGameSettings').style.visibility = 'hidden';
				document.getElementById('overlay').style.backgroundColor = 'rgba(0,0,0,0)';
				document.getElementById('createJoinButton').disabled = false;
			};
			function hideJoinNewGame() {
				document.getElementById('joinNewGame').style.visibility = 'hidden';
				document.getElementById('overlay').style.backgroundColor = 'rgba(0,0,0,0)';
				document.getElementById('createJoinButton').disabled = false;
			};
			function showAYSPrompt() {
				document.getElementById('AYSprompt').style.visibility = 'visible';
				document.getElementById('overlay').style.backgroundColor = 'rgba(0,0,0,0.5)';
				document.getElementById('createJoinButton').disabled = true;
			};
			function showNewGameSettings() {
				document.getElementById('newGameSettings').style.visibility = 'visible';
				document.getElementById('overlay').style.backgroundColor = 'rgba(0,0,0,0.5)';
				document.getElementById('createJoinButton').disabled = true;
			};
			function showJoinNewGame() {
				document.getElementById('joinNewGame').style.visibility = 'visible';
				document.getElementById('overlay').style.backgroundColor = 'rgba(0,0,0,0.5)';
				document.getElementById('createJoinButton').disabled = true;
			};

			function newGameWarning() {
				/*if (cookieHasUnfinishedGame == true) {
				var AYStext = "You are about to start a new game, but still have\n\ran unfinished saved game. By starting a new game,\n\ryour previous saved game will be replaced.\n\r\n\rPlease confirm you want to do this by typing\n\r\"Clear saved game\"\n\rand choosing to create or join a new game.";
				if (consent === "Clear saved game") {*/
				/*};
				} else {
					var AYStext = "Please select whether to host a new game (Create game) or join an already hosted game based on a room code received from the host (Join game).";
					document.getElementById('AYStextField').innerHTML = AYStext;
					showAYSPrompt();
				};*/
				var AYStext = 'TEMPORARY TEXT<BR>Please select whether to host a new game (Create game) or join an already hosted game based on a room code received from the host (Join game).';
				document.getElementById('AYStextField').innerHTML = AYStext;
				showAYSPrompt();
			};

			function newGameSettings() {
				hideAYSPrompt();
				showNewGameSettings();
				/*if (document.getElementById("comName").value.length > 3) {
					console.log("Your commander is " + document.getElementById("comName").value);
					
				} else {
					console.log("Your commander name must be at least 4 characters long");
				}*/
			};

			function joinNewGame() {
				hideAYSPrompt();
				showJoinNewGame();
			};

			function roomCodeCheck() {
				if (document.getElementById('roomCode').value === 'TESTroom') {
					console.log('Room code accepted for testing purposes.');
					goToLobby();
					//Insert lobby code here
				} else {
					alert('Room code not found. Please check for spelling errors.');
				};
			};

			function goToLobby() {
				hideNewGameSettings();
				hideJoinNewGame();
			};

			hideAYSPrompt();
			hideNewGameSettings();
			hideJoinNewGame();
		</script>
	</body>