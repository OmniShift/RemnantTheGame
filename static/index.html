<!DOCTYPE html>

<html lang='en'>
	<head>
		<meta charset='utf-8' />
		<link type='text/css' rel='stylesheet' href='style.css'/>
		<title>Remnant - The Game</title>
	</head>
	<script src='/socket.io/socket.io.js'></script>
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js'></script>
	<script>
		$(document).ready(function() {
			var socket = io();
			var el = document.getElementById('serverTime');
			var newsDate = '';
			var newsContent = '';

			socket.on('time', function(timeString) {
				el.innerHTML = 'Server time: ' + timeString;
			});
			socket.emit('news request');
			socket.on('news', function(newsObject) {
				newsDate = newsObject.substring((newsObject.search('newsdate') + 11), (newsObject.search(',') - 1));
				newsContent = newsObject.substring((newsObject.search('newscontent') + 14), (newsObject.length - 2));
				$('<tr></tr>').append('<td class=\'newsTime\'>' + newsDate + '</td><td class=\'newsContent\'>' + newsContent + '</td>').prependTo('#newsTable');
			});

			//UserID is checked or generates
			//document.cookie = "rtgUID=AdmUsr; expires=Thu, 31 Dec 2026 12:00:00 GMT";
			function checkCookie() {
				var userID = getCookie('rtgUID', 6);
				if (userID != '') {
					console.log('User ' + userID + ' is connected.');
					socket.emit('existing user connection', userID);
				} else {
					console.log('New user connected. ID will be generated.');
					generateUID();
				};
			};
			function getCookie(cname, cvallength) {
				return document.cookie.substring(document.cookie.search(cname) + cname.length + 1, (document.cookie.search(cname) + cname.length + 1 + cvallength));
			};
			function generateUID() {
				socket.emit('generate UID');
				console.log('generate UID request sent');
			};
			socket.on('return generated UID', function(userID) {
				document.cookie = 'rtgUID=' + userID + '; expires=Thu, 31 Dec 2026 12:00:00 GMT';
				console.log('Your new ID is ' + getCookie('rtgUID', 6));
			});
			checkCookie();

			function generateGRID() {
				socket.emit('generate GRID');
				console.log('generate GRID request sent');
			};
			socket.on('return generated GRID', function(gameRoomID) {
				document.cookie = 'rtgLastGame=' + gameRoomID + '; expires=Thu, 31 Dec 2026 12:00:00 GMT';
				console.log('Your new ID is ' + getCookie('rtgLastGame', 5));
				document.getElementById('hostLobby').value = gameRoomID;
				showHostLobby();
			});
			function testFunc() {
				window.location.href = '/test.php';
			};
			function toTestersPage() {
				window.location.href = '/setTesters.html';
			};

			function hideAYSPrompt() {
				document.getElementById('AYSprompt').style.visibility = 'hidden';
				document.getElementById('overlay').style.backgroundColor = 'rgba(0,0,0,0)';
				document.getElementById('createJoinButton').disabled = false;
			};
			function hideNewGameSettings() {
				document.getElementById('newGameSettings').style.visibility = 'hidden';
				document.getElementById('overlay').style.backgroundColor = 'rgba(0,0,0,0)';
				document.getElementById('createJoinButton').disabled = false;
			};
			function hideJoinNewGame() {
				document.getElementById('joinNewGame').style.visibility = 'hidden';
				document.getElementById('overlay').style.backgroundColor = 'rgba(0,0,0,0)';
				document.getElementById('createJoinButton').disabled = false;
			};
			function hideHostLobby() {
				document.getElementById('hostLobby').style.visibility = 'hidden';
				document.getElementById('overlay').style.backgroundColor = 'rgba(0,0,0,0)';
				document.getElementById('createJoinButton').disabled = false;
			};
			function hideClientLobby() {
				document.getElementById('clientLobby').style.visibility = 'hidden';
				document.getElementById('overlay').style.backgroundColor = 'rgba(0,0,0,0)';
				document.getElementById('createJoinButton').disabled = false;
			};
			function showAYSPrompt() {
				document.getElementById('AYSprompt').style.visibility = 'visible';
				document.getElementById('overlay').style.backgroundColor = 'rgba(0,0,0,0.5)';
				document.getElementById('createJoinButton').disabled = true;
			};
			function showNewGameSettings() {
				document.getElementById('newGameSettings').style.visibility = 'visible';
				document.getElementById('overlay').style.backgroundColor = 'rgba(0,0,0,0.5)';
				document.getElementById('createJoinButton').disabled = true;
			};
			function showJoinNewGame() {
				document.getElementById('joinNewGame').style.visibility = 'visible';
				document.getElementById('overlay').style.backgroundColor = 'rgba(0,0,0,0.5)';
				document.getElementById('createJoinButton').disabled = true;
			};
			function showHostLobby() {
				document.getElementById('hostLobby').style.visibility = 'visible';
				document.getElementById('overlay').style.backgroundColor = 'rgba(0,0,0,0.5)';
				document.getElementById('createJoinButton').disabled = true;
			};
			function showClientLobby() {
				document.getElementById('clientLobby').style.visibility = 'visible';
				document.getElementById('overlay').style.backgroundColor = 'rgba(0,0,0,0.5)';
				document.getElementById('createJoinButton').disabled = true;
			};

			function newGameWarning() {
				/*if (cookieHasUnfinishedGame == true) {
				var AYStext = "You are about to start a new game, but still have\n\ran unfinished saved game. By starting a new game,\n\ryour previous saved game will be replaced.\n\r\n\rPlease confirm you want to do this by typing\n\r\"Clear saved game\"\n\rand choosing to create or join a new game.";
				if (consent === "Clear saved game") {*/
				/*};
				} else {
					var AYStext = "Please select whether to host a new game (Create game) or join an already hosted game based on a room code received from the host (Join game).";
					document.getElementById('AYStextField').innerHTML = AYStext;
					showAYSPrompt();
				};*/
				var AYStext = 'TEMPORARY TEXT<BR>Please select whether to host a new game (Create game) or join an already hosted game based on a room code received from the host (Join game).';
				document.getElementById('AYStextField').innerHTML = AYStext;
				showAYSPrompt();
			};

			function newGameSettings() {
				hideAYSPrompt();
				showNewGameSettings();
				/*if (document.getElementById("comName").value.length > 3) {
					console.log("Your commander is " + document.getElementById("comName").value);
					
				} else {
					console.log("Your commander name must be at least 4 characters long");
				}*/
			};

			function joinNewGame() {
				hideAYSPrompt();
				showJoinNewGame();
			};

			function roomCodeCheck() {
				if (document.getElementById('roomCode').value === 'TESTr') {
					console.log('Room code accepted for testing purposes.');
					joinLobby();
					//Insert lobby code here
				} else {
					alert('Room code not found. Please check for spelling errors.');
				};
			};

			function joinLobby() {
				hideJoinNewGame();
				showClientLobby();
			};
			function createLobby() {
				hideNewGameSettings();
				generateGRID();
			};

			hideAYSPrompt();
			hideNewGameSettings();
			hideJoinNewGame();
			hideHostLobby()
			hideClientLobby()
		});
	</script>
	<body>
		<div id='backgroundMain'>
		<div id='overlay'>
			<div id='serverTime' style='text-align:center'></div><BR>
			<div id='newsBoard'><b>News</b><BR>
				<div style='width:600px; height:2px; display:inline-block; background-color:black'></div><BR>
				<table id='newsTable' style='padding:5px'>
					<!--<tr>
						<td class='newsTime'>11-7-2016</td>
						<td class='newsContent'>After a long time of silence, the home page is finally mostly functional up until the creation of lobbies. Let the socket work begin! ...tomorrow.</td>
					</tr>
					<tr>
						<td class='newsTime'>19-6-2016</td>
						<td class='newsContent'>The news feed's basic code has been set up, with exception of the connection to the database to update it without having to take down the whole website.</td>
					</tr>
					<tr>
						<td class='newsTime'>18-6-2016</td>
						<td class='newsContent'>I know I didn't have a news feed at this date, but that's none of your business. I just need some extra code to help me remind how to add more news in the future!</td>
					</tr>-->
				</table>
			</div>

			<div style='text-align:center'><h1>Remnant - The Game</h1>
			<h2>Show those pesky Remnantians who was meant to rule them</h2>
			<button id='createJoinButton' onclick='newGameWarning()'>Create/Join New Game</button><BR>
			<button id='continueGameButton' onclick='continueGame()' disabled=''>Continue Game</button><BR>
			<button id='testerIDButton' onclick='toTestersPage()'>To Testers Page</button><BR>
			<!--<button onclick='testFunc()'>php test</button><BR>
			<button onclick="showNewGameSettings()">test button 2</button></div>-->

			<div class='popUp' id='newGameSettings'>
				<div class='popUpTop' style='text-align:center'><div style='font-weight:bold; font-size:1.7em; padding:7px'>New game</div>
					<!--<b><u>Commander name:</u></b><BR>
					<input id="comName" type="text" name="commander"><BR>-->
					<p style='text-align:center; font-size:1.5em'>There are no settings yet this early on in the game's development, so you have no options to choose from.</p>
					<p style='text-align:center; font-size:1.5em'>...you lucky devil!</p>
				</div>
				<!--<BR>
				<div class="popUpList">
					<b><u>Base game:</u></b><BR>
					<select>
						<option id="baseGamePack" value="original">Original</option>
					</select><BR>
					<BR>
					<b><u>Expansions:</u></b><BR>
					<input id="semblanceExp" type="checkbox" name="semblance" disabled="">test1 (N/A)<BR>
					<input id="modernDayHeroesExp" type="checkbox" name="modernDayHeroes" disabled="">test2 (N/A)<BR>
				</div>
				<div class="popUpList">
					<b><u>'Features':</u></b><BR>
					<input type="checkbox" name="tuck" disabled="">test (N/A)<BR>
				</div>
				<BR>-->
				<div class='popUpBottom'>
					<button onclick='createLobby()'>Create</button>
					<button onclick='hideNewGameSettings()'>Cancel</button>
				</div>
			</div>

			<div class='popUp' id='AYSprompt'>
				<div class='popUpTop' style='text-align:center'>
					<div style='font-weight:bold; font-size:1.7em; padding:7px'>Create/join new game</div>
					<p id='AYStextField' style='font-size:1.2em'></p>
				</div>
				<div class='popUpBottom'>
					<button onclick='newGameSettings()'>Create game</button>
					<button onclick='joinNewGame()'>Join game</button>
					<button onclick='hideAYSPrompt()'>Cancel</button>
				</div>
			</div>

			<div class='popUp' id='joinNewGame'>
				<div class='popUpTop' style='text-align:center'>
					<div style='font-weight:bold; font-size:1.7em; padding:7px'>Join new game</div>
				</div>
				<div class='popUpBottom'>
					<p style='font-size:1.2em'>Please insert your room code:<BR>
					<input id='roomCode' type='text' name='roomCode' autocomplete='off'></p>
					<button onclick='roomCodeCheck()'>Join game</button>
					<button onclick='hideJoinNewGame()'>Cancel</button>
				</div>
			</div>

			<div class='popUp' id='hostLobby'>
				<div class='popUpTop' style='text-align:center'>
					<div style='font-weight:bold; font-size:1.7em; padding:7px'>Lobby</div>
				</div>
				<div class='popUpBottom'>
					<p style='font-size:1.2em'>Room code: <input id='givenRoomCode' type='text' name='roomCode' readonly></p>
					<button id='startGameButton' onclick='roomCodeCheck()' disabled=''>Start game</button>
					<button onclick='hideJoinNewGame()'>Cancel</button>
				</div>
			</div>
		</div><!--end of overlay-->
		</div><!--end of backgroundMain-->

		<script type='text/javascript'>
		</script>
	</body>